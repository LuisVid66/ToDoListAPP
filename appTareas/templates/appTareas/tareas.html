<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tareas</title>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'appTareas/css/tareas_style.css' %}">
</head>
<body>
    <div class="container">
        <h2>Tareas de {{ user.username }}</h2>
        
        <!-- Botón de cierre de sesión -->
        <div class="logout-container" style="text-align: right;">
            <form action="{% url 'logout' %}" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn-logout">Cerrar Sesión</button>
            </form>
        </div>

        <!-- Formulario para Crear Tarea -->
        {% if not tarea_detail and not confirm_delete %}
        <div class="form-crear-tarea">
            <h3 class="crear-tarea-titulo">Crear Nueva Tarea</h3>
            <form method="post">
                {% csrf_token %}
                <div class="field">
                    <label for="{{ form.descripcion.id_for_label }}">Descripción:</label>
                    {{ form.descripcion }}
                </div>
                <div class="field">
                    <label for="{{ form.fecha_vencimiento.id_for_label }}">Fecha de Vencimiento (YYYY-MM-DD):</label>
                    {{ form.fecha_vencimiento }}
                </div>
                <div class="field">
                    <label for="{{ form.hora_vencimiento.id_for_label }}">Hora de Vencimiento (HH:MM:SS):</label>
                    {{ form.hora_vencimiento }}
                </div>
                <div class="field">
                    <label for="{{ form.completada.id_for_label }}">Completada:</label>
                    {{ form.completada }}
                </div>
                <button type="submit" class="btn-crear-tarea">Crear Tarea</button>
            </form>
        </div>
        {% endif %}

        <!-- Lista de Tareas -->
        <ul>
            {% for tarea in tareas %}
                <li class="{% if tarea == confirm_delete %}tarea-eliminando{% elif tarea.completada %}tarea-completada{% elif tarea.fecha_vencimiento < today %}tarea-pasada{% else %}{% if tarea == tarea_detail %}tarea-editando{% endif %}{% endif %}">
                    <div class="tarea-info">
                        <a href="{% url 'tarea_detail' tarea.pk %}"><strong>{{ tarea.descripcion }}</strong></a> - 
                        Vence el: {{ tarea.fecha_vencimiento }} a las {{ tarea.hora_vencimiento }}<br>
                        <small>Creada el: {{ tarea.fecha_creacion|date:"d-m-Y" }}</small>
                    </div>
                    <div class="acciones">
                        <a href="{% url 'tarea_editar' tarea.pk %}"><button class="editar">Editar</button></a>
                        <a href="{% url 'tarea_eliminar' tarea.pk %}"><button class="eliminar">Eliminar</button></a>
                    </div>
                </li>
            {% endfor %}
        </ul>

        <!-- Formulario para Editar Tarea -->
        {% if tarea_detail %}
        <div class="form-editar-tarea">
            <h3 class="editar-tarea-titulo">Editar Tarea</h3>
            <form method="post">
                {% csrf_token %}
                <div class="field">
                    <label for="{{ form.descripcion.id_for_label }}">Descripción:</label>
                    {{ form.descripcion }}
                </div>
                <div class="field">
                    <label for="{{ form.fecha_vencimiento.id_for_label }}">Fecha de Vencimiento (YYYY-MM-DD):</label>
                    {{ form.fecha_vencimiento }}
                </div>
                <div class="field">
                    <label for="{{ form.hora_vencimiento.id_for_label }}">Hora de Vencimiento (HH:MM:SS):</label>
                    {{ form.hora_vencimiento }}
                </div>
                <div class="field">
                    <label for="{{ form.completada.id_for_label }}">Completada:</label>
                    {{ form.completada }}
                </div>
                <button type="submit" class="btn-editar-tarea">Guardar Cambios</button>
            </form>
            <a href="{% url 'tareas' %}"><button class="btn-cancelar">Cancelar</button></a>
        </div>
        {% endif %}

        <!-- Confirmación de Eliminación -->
        {% if confirm_delete %}
        <div class="confirmar-eliminacion">
            <h3>¿Estás seguro de que quieres eliminar esta tarea?</h3>
            <p>{{ confirm_delete.descripcion }}</p>
            <form method="post">
                {% csrf_token %}
                <button type="submit" class="btn-confirmar">Confirmar</button>
            </form>
            <a href="{% url 'tareas' %}"><button class="btn-cancelar">Cancelar</button></a>
        </div>
        {% endif %}
        
    </div>
</body>
</html>














